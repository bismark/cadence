{
  "id": "0498fcc1",
  "title": "Fix compiler to handle spans split across two pages",
  "tags": [
    "compiler",
    "bug",
    "pagination"
  ],
  "status": "open",
  "created_at": "2026-02-01T04:45:59.976Z"
}

## Issue
When a text span (with associated audio timing) is split across a page break, the compiler needs to handle this gracefully rather than assigning the entire span to one page.

## Proposed Solution
Split the audio timing proportionally based on text distribution:
- If N% of the span's text content is on page 1, associate N% of the audio duration with page 1
- The remaining (100-N)% of audio duration goes to page 2
- This creates two span entries from one original span

## Example
Original span: "This is a long sentence that wraps to the next page"
- Text on page 1: "This is a long sentence that" (60%)
- Text on page 2: "wraps to the next page" (40%)
- Original audio: 0ms - 1000ms
- Split into:
  - Span A: page 1, 0ms - 600ms
  - Span B: page 2, 600ms - 1000ms

## Implementation
- [ ] Detect spans that have highlight rects on multiple pages during pagination
- [ ] Calculate text distribution ratio (by character count or rect area)
- [ ] Split span entry in spans.jsonl with proportional timing
- [ ] Update page JSON files to include correct partial highlight rects

## Relevant Files
- `compiler/src/layout/paginate.ts` - Pagination and rect capture
- `compiler/src/bundle/writer.ts` - Span output generation
- `compiler/src/types.ts` - Span type definitions
