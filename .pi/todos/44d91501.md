{
  "id": "44d91501",
  "title": "Fix highlight flash to previous section when tapping during playback",
  "tags": [
    "player",
    "ui",
    "bug",
    "P2"
  ],
  "status": "closed",
  "created_at": "2026-02-01T05:34:30.593Z"
}

## Fixed

Updated position loop to only update `activeSpan` when position is outside the current span's time range:

```kotlin
val currentSpan = activeSpan
if (currentSpan == null ||
    positionMs < currentSpan.clipBeginMs ||
    positionMs >= currentSpan.clipEndMs) {
    bundle.findSpanAtTime(positionMs.toDouble())?.let { span ->
        activeSpan = span
        if (span.pageIndex != currentPageIndex) {
            currentPageIndex = span.pageIndex
        }
    }
}
```

This prevents the race condition where the tap handler sets `activeSpan` but the position loop immediately overwrites it before the seek completes.

## File
`player/app/src/main/java/com/cadence/player/ui/PlayerScreen.kt`
