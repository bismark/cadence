{
  "id": "2ed61444",
  "title": "[P1] Fix offset calculation bug in transcribeMultiple",
  "tags": [
    "bug",
    "P1",
    "align"
  ],
  "status": "closed",
  "created_at": "2026-02-01T16:49:12.560Z"
}

# Bug: Off-by-one error in multi-file transcription offsets

**File:** `compiler/src/align/parakeet.ts:207-219`

## Problem
```typescript
const offset = combinedTranscript.length;
// Space added conditionally:
if (combinedTranscript.length > 0 && !combinedTranscript.endsWith(' ')) {
  combinedTranscript += ' ';
}
// But offset adjustment always assumes +1:
startOffsetUtf16: entry.startOffsetUtf16! + offset + (offset > 0 ? 1 : 0),
```

Offset adjustment unconditionally adds 1 when `offset > 0`, but space is only conditionally added. This causes incorrect word-to-character mappings when transcribing audiobooks with multiple files.

## Fix
Calculate offset *after* conditionally adding the space, or make the +1 conditional on whether a space was actually added.
