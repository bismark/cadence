{
  "id": "4ee0c341",
  "title": "Support bundle audio output as m4a or opus",
  "tags": [
    "compiler",
    "player",
    "audio",
    "bundle-format",
    "feature"
  ],
  "status": "closed",
  "created_at": "2026-02-11T05:38:01.043Z"
}

## Completed
Implemented support for `opus` and `m4a` bundle audio outputs.

### What shipped
- Added compiler CLI option `--audio-format <opus|m4a>` to both `compile` and `align` commands.
- Added shared audio format parsing + filename helpers in `compiler/src/audio/concat.ts`.
- Extended FFmpeg encode path to support:
  - `opus` -> `libopus` (`audio.opus`)
  - `m4a` -> AAC (`audio.m4a`)
- Updated bundle metadata schema to include `meta.audioFile`.
- Updated compile + align writers to emit the selected audio file and to use `meta.audioFile` as the bundle audio source of truth.
- Updated compiler inspect output to show `Audio file`.
- Updated player bundle model to require `audioFile` and load audio from `"$basePath/${meta.audioFile}"` instead of hardcoded `audio.opus`.

### Verification
- Compiler TypeScript build passed (`cd compiler && npm run build`).
- End-to-end compiler smoke test passed for both formats (`--audio-format m4a` and default opus).
- Player verification passed (`./.pi/skills/player-verify/run.sh` -> compileDebugKotlin, detekt, lintDebug, buildHealth).
