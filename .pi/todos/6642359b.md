{
  "id": "6642359b",
  "title": "[P2] Validate bundle meta.audioFile before resolving player audio path",
  "tags": [
    "player",
    "security",
    "bundle",
    "P2"
  ],
  "status": "closed",
  "created_at": "2026-02-13T19:42:29.373Z"
}

`player/app/src/main/java/com/cadence/player/data/Bundle.kt` builds audio path as:

`"$basePath/${meta.audioFile}"`

`meta.audioFile` comes from bundle metadata and is currently not validated. A crafted bundle can use path traversal segments (for example `../../...`) to resolve outside the bundle directory and make the player open unintended files.

## Fix
Validate/canonicalize `meta.audioFile` and enforce that the resolved path remains inside `basePath`.

## Acceptance
- Rejects traversal and absolute-path values in `meta.audioFile`.
- Accepts expected bundle-local filenames (e.g. `audio.opus`, `audio.m4a`).
- Fails fast with a clear error when invalid.

### Completed
- Hardened `player/app/src/main/java/com/cadence/player/data/Bundle.kt` by validating and canonicalizing `meta.audioFile` when constructing `CadenceBundle.audioPath`.
- Added explicit rejection for absolute paths (`/`, `\\`, and Windows drive-prefixed forms).
- Enforced bundle-root containment by resolving both base and audio paths canonically and requiring the resolved audio path to stay under `basePath`.
- Added fast-fail check that the resolved audio target exists and is a file.
- Error messages now clearly identify invalid `meta.audioFile` values and why they were rejected.

### Verification
- Ran required player checks:
  - `cd player && ./scripts/verify.sh`
  - Includes `:app:compileDebugKotlin`, `detekt`, `:app:lintDebug`, and `buildHealth`.
- Result: **BUILD SUCCESSFUL**.
